<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Catalog Editor â€” data.json</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{--card-radius:12px}
    html,body{height:100%}
    body { background: #f6f8fa; }
    .card{ border-radius:var(--card-radius); }
    .muted-small { font-size: .85rem; color:#6c757d }
    .tag-badge { margin-right:6px }/* Header */
.header-row { align-items:center; gap:12px }
.url-input { width:100%; max-width:720px }

/* First row: categories + editor */
.first-row { display:flex; gap:16px; margin-bottom:16px }
.col-cats { width: 26%; }
.col-editor { width: 74%; }
.cats-card, .editor-card { display:flex; flex-direction:column; height: calc(100vh - 210px); }
.cats-list { overflow:auto; }
.editor-inner { display:flex; gap:12px; height:100%; }
.items-list-wrap { width:38%; display:flex; flex-direction:column; overflow:hidden }
#items-list { overflow:auto; flex:1 }
.form-wrap { width:62%; display:flex; flex-direction:column }
.form-card { display:flex; flex-direction:column; height:100% }
.form-fields { padding:12px; overflow:auto; flex:1 }
.form-actions { border-top:1px solid rgba(0,0,0,0.04); padding:10px; display:flex; justify-content:flex-end; background:#fff }

/* Second row: json viewer full width */
.json-row { height: calc(40vh); }
.json-card { height:100%; display:flex; flex-direction:column }
.json-tree { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:0.9rem; }
.json-node { margin-left: 10px; }
details.json-branch > summary { cursor: pointer; list-style: none; }
details.json-branch > summary::-webkit-details-marker { display: none; }
.json-key { color: #2b6cb0; }
.json-string { color: #2f855a; }
.json-number { color: #d53f8c; }
.json-boolean { color: #b67900; }
.json-null { color: #6c757d; }
.json-bracket { color: #333; }

@media (max-width: 991.98px){ .url-input{ max-width:520px } }
@media (max-width: 767.98px){ .first-row { flex-direction:column } .col-cats, .col-editor { width:100% } .cats-card, .editor-card { height:auto } .json-row{ height:320px } }

.list-group-item { cursor:pointer }

  </style>
</head>
<body>
  <div class="container-fluid py-3">
    <div class="row header-row mb-3 align-items-center">
      <div class="col-12 col-md-3">
        <h3 class="mb-0"><i class="fa-solid fa-database"></i> Catalog Editor</h3>
        <div class="muted-small d-none d-md-block">Always loads JSON from the given GitHub URL, edit visually, then copy or download the updated JSON.</div>
      </div><div class="col-12 col-md-6 d-flex justify-content-center">
    <div class="input-group url-input">
      <input type="text" id="sourceUrlInput" class="form-control form-control-sm" aria-label="JSON URL" />
      <button class="btn btn-sm btn-primary" id="btn-load-url"><i class="fa-solid fa-download"></i>&nbsp;Load</button>
      <button class="btn btn-sm btn-outline-secondary" id="btn-reset-url">Reset</button>
    </div>
  </div>

  <div class="col-12 col-md-3 text-md-end mt-2 mt-md-0">
    <button id="btn-generate" class="btn btn-primary btn-sm me-2"><i class="fa-solid fa-pen"></i> Generate JSON</button>
    <button id="btn-copy" class="btn btn-success btn-sm me-2"><i class="fa-solid fa-copy"></i> Copy JSON</button>
    <button id="btn-download" class="btn btn-outline-success btn-sm"><i class="fa-solid fa-file-arrow-down"></i> Download</button>
  </div>
</div>

<!-- FIRST ROW: Categories + Editor Canvas -->
<div class="first-row">
  <div class="col-cats">
    <div class="card cats-card">
      <div class="card-body p-3 d-flex flex-column">
        <div class="d-flex mb-2 align-items-center">
          <h6 class="mb-0">Categories</h6>
          <button id="add-category" class="btn btn-sm btn-outline-primary ms-auto" title="Add category"><i class="fa-solid fa-plus"></i></button>
        </div>
        <div id="categories-list" class="list-group flex-grow-1 cats-list"></div>
      </div>
    </div>
  </div>

  <div class="col-editor">
    <div class="card editor-card">
      <div class="card-body p-3 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div>
            <h6 id="selected-cat-name" class="mb-0">Select a category</h6>
            <div id="selected-cat-meta" class="muted-small"></div>
          </div>
          <div>
            <button id="add-item" class="btn btn-sm btn-outline-primary" disabled><i class="fa-solid fa-file-circle-plus"></i>&nbsp;Add</button>
            <button id="delete-cat" class="btn btn-sm btn-outline-danger ms-2" disabled title="Delete category"><i class="fa-solid fa-trash"></i></button>
          </div>
        </div>

        <div class="editor-inner" style="flex:1; display:flex; gap:12px;">
          <div class="items-list-wrap">
            <div class="mb-2"><small class="muted-small">Items</small></div>
            <div id="items-list" class="list-group h-100 overflow-auto"></div>
          </div>

          <div class="form-wrap">
            <div class="form-card">
              <div class="form-fields bg-white rounded-1">
                <form id="item-form">
                  <input type="hidden" id="form-cat-id" />
                  <input type="hidden" id="form-item-id" />

                  <div class="mb-2">
                    <label class="form-label small">Title</label>
                    <input id="form-title" class="form-control form-control-sm" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label small">ID</label>
                    <input id="form-id" class="form-control form-control-sm" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label small">Type</label>
                    <select id="form-type" class="form-select form-select-sm">
                      <option value="text">text</option>
                      <option value="links">links</option>
                      <option value="table">table</option>
                      <option value="notes">notes</option>
                      <option value="code">code</option>
                      <option value="image">image</option>
                      <option value="other">other</option>
                    </select>
                  </div>

                  <div class="mb-2">
                    <label class="form-label small">Created</label>
                    <input id="form-created" type="date" class="form-control form-control-sm" />
                  </div>

                  <div class="mb-2">
                    <label class="form-label small">Tags (comma-separated)</label>
                    <input id="form-tags" class="form-control form-control-sm" />
                  </div>

                  <div id="payload-area" class="mb-2">
                    <label class="form-label small">Payload (JSON)</label>
                    <textarea id="form-payload-json" class="form-control form-control-sm" rows="6"></textarea>
                    <div class="form-text muted-small">Edit payload as JSON here.</div>
                  </div>
                </form>
              </div>

              <div class="form-actions">
                <button type="button" id="save-item" class="btn btn-primary btn-sm">Save</button>
                <button type="button" id="delete-item" class="btn btn-danger btn-sm ms-2">Delete</button>
              </div>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>
</div>

<!-- SECOND ROW: full-width JSON viewer -->
<div class="json-row">
  <div class="card json-card">
    <div class="card-body p-3 d-flex flex-column">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h6 class="mb-0">JSON Viewer</h6>
        <div class="tree-controls">
          <button id="btn-expand-all" class="btn btn-sm btn-outline-secondary" title="Expand all"><i class="fa-solid fa-plus"></i></button>
          <button id="btn-collapse-all" class="btn btn-sm btn-outline-secondary" title="Collapse all"><i class="fa-solid fa-minus"></i></button>
        </div>
      </div>

      <div id="json-tree" class="json-tree flex-grow-1 border rounded bg-white p-2 overflow-auto"></div>
      <div class="mt-2 text-end muted-small">Click keys to expand/collapse.</div>
    </div>
  </div>
</div>

  </div>  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>  <script>
    const DEFAULT_SOURCE = 'https://raw.githubusercontent.com/thejeshpr/info/refs/heads/main/data.json';
    let sourceUrl = DEFAULT_SOURCE;
    let catalog = null; let selectedCategoryId = null; let selectedItemId = null;

    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    async function loadCatalog(){
      try{
        const res = await fetch(sourceUrl, { cache: 'no-store' });
        if(!res.ok) throw new Error('Failed to fetch: '+res.status);
        catalog = await res.json();
        if(!catalog || typeof catalog !== 'object') throw new Error('Invalid JSON');
        if(!Array.isArray(catalog.categories)) catalog.categories = [];
        selectedCategoryId = null; selectedItemId = null; renderCategories(); renderItemsListEmpty(); renderTree();
      }catch(err){ console.error(err); alert('Error loading JSON from source. See console.'); catalog = { meta:{title:'Untitled', updated:new Date().toISOString().slice(0,10)}, categories:[] }; renderCategories(); renderTree(); }
    }

    function renderCategories(){ const $list = $('#categories-list').empty(); (catalog.categories||[]).forEach(cat=>{ const $item = $(`\n      <button type="button" class="list-group-item list-group-item-action d-flex align-items-center" data-id="${cat.id}">\n        <div>\n          <div><strong>${escapeHtml(cat.name)}</strong></div>\n          <div class="muted-small">${escapeHtml(cat.id)}</div>\n        </div>\n        <div class="ms-auto badge bg-secondary rounded-pill">${(cat.items||[]).length}</div>\n      </button>`); $item.on('click', ()=> selectCategory(cat.id)); $list.append($item); }); }

    function renderItemsListEmpty(){ $('#items-list').empty(); $('#form-title').val(''); $('#form-id').val(''); $('#form-type').val('text'); $('#form-created').val(''); $('#form-tags').val(''); $('#form-payload-json').val('{}'); $('#delete-item').prop('disabled', true); }

    function selectCategory(catId){ selectedCategoryId = catId; const cat = (catalog.categories||[]).find(c=>c.id===catId); if(!cat) return; $('#selected-cat-name').text(cat.name); $('#selected-cat-meta').text('id: '+cat.id+' â€” '+(cat.items?cat.items.length:0)+' items'); $('#add-item').prop('disabled', false); $('#delete-cat').prop('disabled', false).off('click').on('click', ()=>{ if(confirm('Delete category '+cat.name+'?')) deleteCategory(cat.id); }); renderCategories(); renderItems(cat); clearForm(); }

    function renderItems(cat){ const $list=$('#items-list').empty(); (cat.items||[]).forEach(it=>{ const $it = $(`\n      <button type="button" class="list-group-item list-group-item-action d-flex align-items-start" data-id="${it.id}">\n        <div style="flex:1">\n          <div><strong>${escapeHtml(it.title)}</strong></div>\n          <div class="muted-small">${escapeHtml(it.id)} â€¢ ${escapeHtml(it.type||'')} â€¢ ${escapeHtml(it.created||'')}</div>\n        </div>\n        <div>${(it.tags||[]).map(t=>`<span class="badge bg-light text-dark tag-badge">${escapeHtml(t)}</span>`).join('')}</div>\n      </button>`); $it.on('click', ()=> selectItem(cat.id, it.id)); $list.append($it); }); }

    function selectItem(catId,itemId){ selectedItemId=itemId; const cat=(catalog.categories||[]).find(c=>c.id===catId); const it=(cat&&cat.items||[]).find(x=>x.id===itemId); if(!it) return; $('#form-cat-id').val(catId); $('#form-item-id').val(itemId); $('#form-title').val(it.title||''); $('#form-id').val(it.id||''); $('#form-type').val(it.type||'other'); $('#form-created').val(it.created||''); $('#form-tags').val((it.tags||[]).join(', ')); $('#form-payload-json').val(JSON.stringify(it.payload||{}, null,2)); $('#delete-item').prop('disabled', false).off('click').on('click', ()=>{ if(confirm('Delete item '+it.title+'?')) deleteItem(catId,itemId); }); $('#items-list .list-group-item').removeClass('active'); $(`#items-list .list-group-item[data-id='${itemId}']`).addClass('active'); }

    function clearForm(){ selectedItemId=null; $('#form-cat-id').val(''); $('#form-item-id').val(''); $('#form-title').val(''); $('#form-id').val(''); $('#form-type').val('text'); $('#form-created').val(''); $('#form-tags').val(''); $('#form-payload-json').val('{}'); $('#delete-item').prop('disabled', true); $('#items-list .list-group-item').removeClass('active'); }

    function addCategory(){ const name=prompt('Category name'); if(!name) return; const id=slugify(name); if((catalog.categories||[]).find(c=>c.id===id)){ alert('A category with this id already exists.'); return; } const cat={id,name,items:[]}; catalog.categories.push(cat); renderCategories(); selectCategory(id); renderTree(); }
    function deleteCategory(catId){ catalog.categories=(catalog.categories||[]).filter(c=>c.id!==catId); selectedCategoryId=null; renderCategories(); $('#selected-cat-name').text('Select a category'); $('#selected-cat-meta').text(''); $('#add-item').prop('disabled', true); $('#delete-cat').prop('disabled', true); $('#items-list').empty(); clearForm(); renderTree(); }
    function addItem(){ const cat=(catalog.categories||[]).find(c=>c.id===selectedCategoryId); if(!cat) return; const title=prompt('Item title'); if(!title) return; const id=slugify(title); if((cat.items||[]).find(i=>i.id===id)){ alert('Item id exists in this category.'); return; } const it={id,title,type:'text',created:new Date().toISOString().slice(0,10),tags:[],payload:{}}; cat.items=cat.items||[]; cat.items.push(it); renderItems(cat); selectItem(cat.id,it.id); renderCategories(); renderTree(); }
    function deleteItem(catId,itemId){ const cat=(catalog.categories||[]).find(c=>c.id===catId); if(!cat) return; cat.items=(cat.items||[]).filter(i=>i.id!==itemId); clearForm(); renderItems(cat); renderCategories(); renderTree(); }
    function saveItem(){ const catId=$('#form-cat-id').val()||selectedCategoryId; const cat=(catalog.categories||[]).find(c=>c.id===catId); if(!cat) return alert('No category selected'); const itemIdOrig=$('#form-item-id').val(); const itemId=$('#form-id').val().trim(); const title=$('#form-title').val().trim(); const type=$('#form-type').val(); const created=$('#form-created').val(); const tags=$('#form-tags').val().split(',').map(s=>s.trim()).filter(Boolean); let payload={}; try{ payload=JSON.parse($('#form-payload-json').val()||'{}'); }catch(e){ alert('Payload JSON invalid'); return; } if(itemIdOrig){ const it=(cat.items||[]).find(i=>i.id===itemIdOrig); if(!it) return; if(itemId!==itemIdOrig){ if(cat.items.find(x=>x.id===itemId)) return alert('Another item with that id exists'); } it.id=itemId; it.title=title; it.type=type; it.created=created; it.tags=tags; it.payload=payload; } else { if(cat.items.find(x=>x.id===itemId)) return alert('Item id exists'); const it={id:itemId,title,type,created,tags,payload}; cat.items=cat.items||[]; cat.items.push(it); } renderItems(cat); renderCategories(); renderTree(); }

    // JSON tree rendering (same as before)
    function renderTree(){ const $root=$('#json-tree').empty(); buildJsonTree(catalog,$root); }
    function buildJsonTree(obj,$container){ const rootEl=document.createElement('div'); rootEl.className='json-node'; if(typeof obj==='object'&&obj!==null){ const details=document.createElement('details'); details.className='json-branch'; details.open=true; const summary=document.createElement('summary'); summary.innerHTML=`<span class="json-bracket">{}</span> root`; details.appendChild(summary); const child=document.createElement('div'); child.style.paddingLeft='10px'; renderObject(obj,child); details.appendChild(child); rootEl.appendChild(details); } else { rootEl.textContent=JSON.stringify(obj); } $container.append(rootEl); }
    function renderObject(obj,parentEl){ if(Array.isArray(obj)){ obj.forEach((v,i)=>{ const wrapper=document.createElement('div'); wrapper.className='json-node'; if(typeof v==='object'&&v!==null){ const d=document.createElement('details'); d.className='json-branch'; const s=document.createElement('summary'); s.innerHTML=`<span class="json-key">[${i}]</span> <span class="json-bracket">${Array.isArray(v)?'[]':'{}'}</span>`; d.appendChild(s); const ch=document.createElement('div'); ch.style.paddingLeft='10px'; renderObject(v,ch); d.appendChild(ch); wrapper.appendChild(d); } else { wrapper.innerHTML=`<span class="json-key">[${i}]</span>: <span class="${getJsonClass(v)}">${escapeHtml(String(v))}</span>`; } parentEl.appendChild(wrapper); }); } else { Object.keys(obj).forEach(key=>{ const val=obj[key]; const wrapper=document.createElement('div'); wrapper.className='json-node'; if(typeof val==='object'&&val!==null){ const d=document.createElement('details'); d.className='json-branch'; const s=document.createElement('summary'); s.innerHTML=`<span class="json-key">${escapeHtml(key)}</span>: <span class="json-bracket">${Array.isArray(val)?'[]':'{}'}</span>`; d.appendChild(s); const ch=document.createElement('div'); ch.style.paddingLeft='10px'; renderObject(val,ch); d.appendChild(ch); wrapper.appendChild(d); } else { const vText=(val===null)?'null':(typeof val==='string'?'"'+escapeHtml(val)+'"':escapeHtml(String(val))); wrapper.innerHTML=`<span class="json-key">${escapeHtml(key)}</span>: <span class="${getJsonClass(val)}">${vText}</span>`; } parentEl.appendChild(wrapper); }); } }
    function getJsonClass(v){ if(v===null) return 'json-null'; if(typeof v==='string') return 'json-string'; if(typeof v==='number') return 'json-number'; if(typeof v==='boolean') return 'json-boolean'; return 'json-string'; }
    function expandAll(){ $('#json-tree details.json-branch').prop('open', true); }
    function collapseAll(){ $('#json-tree details.json-branch').prop('open', false); }

    function copyJSON(){ const txt=JSON.stringify(catalog,null,2); navigator.clipboard.writeText(txt).then(()=>alert('Copied JSON to clipboard')).catch(()=>alert('Copy failed')); }
    function downloadJSON(){ const blob=new Blob([JSON.stringify(catalog,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='data.updated.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }
    function slugify(s){ return (s||'').toString().toLowerCase().trim().replace(/[\s\_]+/g,'-').replace(/[^a-z0-9\-]/g,'').replace(/\-+/g,'-').replace(/^\-+|\-+$/g,''); }

    $(function(){
      $('#add-category').on('click', addCategory);
      $('#add-item').on('click', addItem);
      $('#btn-generate').on('click', renderTree);
      $('#btn-copy').on('click', copyJSON);
      $('#btn-download').on('click', downloadJSON);
      $('#save-item').on('click', saveItem);
      $('#btn-load-url').on('click', ()=>{ const v=$('#sourceUrlInput').val().trim(); if(!v) return alert('Enter a URL'); sourceUrl=v; loadCatalog(); });
      $('#btn-reset-url').on('click', ()=>{ sourceUrl=DEFAULT_SOURCE; $('#sourceUrlInput').val(DEFAULT_SOURCE); loadCatalog(); });
      $('#btn-expand-all').on('click', expandAll);
      $('#btn-collapse-all').on('click', collapseAll);
      $('#sourceUrlInput').val(DEFAULT_SOURCE);
      loadCatalog();
    });
  </script></body>
</html>